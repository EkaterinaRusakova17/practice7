using System;
using System.Collections;
using System.Collections.Generic;

public class BinaryTreeNode<T>
{
    public T Value { get; set; }
    public BinaryTreeNode<T> Left { get; set; }
    public BinaryTreeNode<T> Right { get; set; }

    public BinaryTreeNode(T value)
    {
        Value = value;
        Left = null;
        Right = null;
    }

    public class BinaryTree<T> : IEnumerable<T>
    {
        private BinaryTreeNode<T> _root;

        public BinaryTree(BinaryTreeNode<T> rootNode)
        {
            _root = rootNode;
        }

        public IEnumerator<T> GetEnumerator()
        {
            return new InOrderIterator<T>(_root);
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }

        public IEnumerable<T> InOrderTraversal()
        {
            return TraverseInOrder(_root);
        }

        public IEnumerable<T> PreOrderTraversal()
        {
            return _TraversePreOrder(_root);
        }

        public IEnumerable<T> PostOrderTraversal()
        {
            return _TraversePostOrder(_root);
        }

        private IEnumerable<T> TraverseInOrder(BinaryTreeNode<T> node)
        {
            if (node != null)
            {
                foreach (var item in TraverseInOrder(node.Left))
                {
                    yield return item;
                }
                yield return node.Value;
                foreach (var item in TraverseInOrder(node.Right))
                {
                    yield return item;
                }
            }
        }

        private IEnumerable<T> _TraversePreOrder(BinaryTreeNode<T> node)
        {
            if (node != null)
            {
                yield return node.Value;
                foreach (var item in _TraversePreOrder(node.Left))
                {
                    yield return item;
                }
                foreach (var item in _TraversePreOrder(node.Right))
                {
                    yield return item;
                }
            }
        }

        private IEnumerable<T> _TraversePostOrder(BinaryTreeNode<T> node)
        {
            if (node != null)
            {
                foreach (var item in _TraversePostOrder(node.Left))
                {
                    yield return item;
                }
                foreach (var item in _TraversePostOrder(node.Right))
                {
                    yield return item;
                }
                yield return node.Value;
            }
        }
    }

    public class InOrderIterator<T> : IEnumerator<T>
    {
        private BinaryTreeNode<T> _current;
        private Stack<BinaryTreeNode<T>> _stack;

        public InOrderIterator(BinaryTreeNode<T> root)
        {
            _current = root;
            _stack = new Stack<BinaryTreeNode<T>>();
        }

        public T Current
        {
            get { return _current.Value; }
        }

        object IEnumerator.Current => Current;

        public bool MoveNext()
        {
            while (_current != null || _stack.Count > 0)
            {
                if (_current != null)
                {
                    _stack.Push(_current);
                    _current = _current.Left;
                }
                else
                {
                    _current = _stack.Pop();
                    var value = _current.Value;
                    _current = _current.Right;
                    return true;
                }
            }
            return false;
        }

        public void Reset()
        {
            throw new NotImplementedException();
        }

        public void Dispose()
        {
        }
    }

    class Program
    {
        static void Main()
        {
            var root = new BinaryTreeNode<int>(1);
            root.Left = new BinaryTreeNode<int>(2);
            root.Right = new BinaryTreeNode<int>(3);
            root.Left.Left = new BinaryTreeNode<int>(4);
            root.Left.Right = new BinaryTreeNode<int>(5);

            var tree = new BinaryTree<int>(root);

            Console.WriteLine("Прямой обход:");
            foreach (var node in tree.InOrderTraversal())
            {
                Console.Write(node + " ");
            }
            Console.WriteLine();

            Console.WriteLine("Обратный обход:");
            foreach (var node in tree.PreOrderTraversal())
            {
                Console.Write(node + " ");
            }
            Console.WriteLine();

            Console.WriteLine("Обратный обход:");
            foreach (var node in tree.PostOrderTraversal())
            {
                Console.Write(node + " ");
            }
            Console.WriteLine();
        }
    }
}
